services:
  apiserver-backend:
    build:
      context: api-server/.
      dockerfile: Dockerfile
    ports:
      - "1781:1781"
    depends_on:
      - apiserver-database
    hostname: apiserver
    environment:
      LOG_FOLDER: logs/
      MS_API_CONFIG_PATH: /app/config/test/config.yml #TODO как то прокинуть тест/прод
      DB_USER: ${MS_APISERVER_DB_USER}
      DB_PASS: ${MS_APISERVER_DB_PASS}
      DB_NAME: ${MS_APISERVER_DB_NAME}
      YAS3_KEY: ${MS_APISERVER_YAS3_KEY}
      YAS3_SECRET: ${MS_APISERVER_YAS3_SECRET}
      PASS_SALT: "SALT"
      AWS_REGION: "ru-central1"
    volumes:
      - ./api-server/logs:/app/logs


  apiserver-database:
    restart: always
    hostname: database
    image: postgres:16
    ports:
      - "5432:5432"
    environment:
        POSTGRES_USER: ${MS_APISERVER_DB_USER}
        POSTGRES_PASSWORD: ${MS_APISERVER_DB_PASS}
        POSTGRES_DB: ${MS_APISERVER_DB_NAME}
    volumes:
      - db:/var/lib/postgresql/data


  tgclient-backend:
    build:
      context: ./
      dockerfile: tg-client/Dockerfile
    environment:
      MS_TGCLIENT_BOT_TOKEN: ${MS_TGCLIENT_BOT_TOKEN}
      MS_DATA_FOLDER: "./data"
      LOG_FOLDER: "logs/"
      API_SERVER: "http://apiserver:1781"
    volumes:
      - ./tg-client/logs:/app/logs
      - ./tg-client/data:/app/data


volumes:
  db:
